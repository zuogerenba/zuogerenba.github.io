<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、React组件定义方式 | 邱模建的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/avatar.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.101e93c3.css" as="style"><link rel="preload" href="/assets/js/app.ab08ac82.js" as="script"><link rel="preload" href="/assets/js/2.fe6dca74.js" as="script"><link rel="preload" href="/assets/js/102.4b0b16e2.js" as="script"><link rel="prefetch" href="/assets/js/10.44ca1bce.js"><link rel="prefetch" href="/assets/js/100.ff4a7272.js"><link rel="prefetch" href="/assets/js/101.4f5b1dfc.js"><link rel="prefetch" href="/assets/js/103.cb5f3e5c.js"><link rel="prefetch" href="/assets/js/104.b1811512.js"><link rel="prefetch" href="/assets/js/105.aa082472.js"><link rel="prefetch" href="/assets/js/106.91d2c8b0.js"><link rel="prefetch" href="/assets/js/107.3dea83b1.js"><link rel="prefetch" href="/assets/js/108.236a9cb3.js"><link rel="prefetch" href="/assets/js/109.8deba790.js"><link rel="prefetch" href="/assets/js/11.0dcd522a.js"><link rel="prefetch" href="/assets/js/110.0e0d34b4.js"><link rel="prefetch" href="/assets/js/111.0b565b05.js"><link rel="prefetch" href="/assets/js/112.cbd56ebc.js"><link rel="prefetch" href="/assets/js/113.6b220f73.js"><link rel="prefetch" href="/assets/js/114.84e8b596.js"><link rel="prefetch" href="/assets/js/115.9fc640b7.js"><link rel="prefetch" href="/assets/js/116.9a86f717.js"><link rel="prefetch" href="/assets/js/12.3ecee4d7.js"><link rel="prefetch" href="/assets/js/13.dc43ca20.js"><link rel="prefetch" href="/assets/js/14.2a807370.js"><link rel="prefetch" href="/assets/js/15.f2ae64fb.js"><link rel="prefetch" href="/assets/js/16.6cefb4c6.js"><link rel="prefetch" href="/assets/js/17.fba8bb8c.js"><link rel="prefetch" href="/assets/js/18.4d5bfc74.js"><link rel="prefetch" href="/assets/js/19.71623cf1.js"><link rel="prefetch" href="/assets/js/20.c1d3e8bd.js"><link rel="prefetch" href="/assets/js/21.89055cf4.js"><link rel="prefetch" href="/assets/js/22.4954c039.js"><link rel="prefetch" href="/assets/js/23.7c6f9745.js"><link rel="prefetch" href="/assets/js/24.4a9c9785.js"><link rel="prefetch" href="/assets/js/25.01027ef7.js"><link rel="prefetch" href="/assets/js/26.fb9ca95d.js"><link rel="prefetch" href="/assets/js/27.c0398869.js"><link rel="prefetch" href="/assets/js/28.d1b45b70.js"><link rel="prefetch" href="/assets/js/29.b42a2154.js"><link rel="prefetch" href="/assets/js/3.872ae142.js"><link rel="prefetch" href="/assets/js/30.fba61f27.js"><link rel="prefetch" href="/assets/js/31.4c8105b8.js"><link rel="prefetch" href="/assets/js/32.4390fdb1.js"><link rel="prefetch" href="/assets/js/33.fb22efe6.js"><link rel="prefetch" href="/assets/js/34.c790ec04.js"><link rel="prefetch" href="/assets/js/35.9559fbf9.js"><link rel="prefetch" href="/assets/js/36.bf93938b.js"><link rel="prefetch" href="/assets/js/37.49295366.js"><link rel="prefetch" href="/assets/js/38.90fc60b9.js"><link rel="prefetch" href="/assets/js/39.a18d83e7.js"><link rel="prefetch" href="/assets/js/4.08c03269.js"><link rel="prefetch" href="/assets/js/40.08bcd26b.js"><link rel="prefetch" href="/assets/js/41.9f70e821.js"><link rel="prefetch" href="/assets/js/42.b6f1d960.js"><link rel="prefetch" href="/assets/js/43.1bc00c36.js"><link rel="prefetch" href="/assets/js/44.89fd78b3.js"><link rel="prefetch" href="/assets/js/45.66558dce.js"><link rel="prefetch" href="/assets/js/46.6fb2cd24.js"><link rel="prefetch" href="/assets/js/47.d56d286f.js"><link rel="prefetch" href="/assets/js/48.35519a50.js"><link rel="prefetch" href="/assets/js/49.361857da.js"><link rel="prefetch" href="/assets/js/5.581fb300.js"><link rel="prefetch" href="/assets/js/50.d8fd2f28.js"><link rel="prefetch" href="/assets/js/51.92e3216f.js"><link rel="prefetch" href="/assets/js/52.fbc53d2a.js"><link rel="prefetch" href="/assets/js/53.eff022d3.js"><link rel="prefetch" href="/assets/js/54.634800e1.js"><link rel="prefetch" href="/assets/js/55.4c05b71c.js"><link rel="prefetch" href="/assets/js/56.4ab46734.js"><link rel="prefetch" href="/assets/js/57.ca27214f.js"><link rel="prefetch" href="/assets/js/58.d5242a99.js"><link rel="prefetch" href="/assets/js/59.0195abe1.js"><link rel="prefetch" href="/assets/js/6.f3fdc29d.js"><link rel="prefetch" href="/assets/js/60.f4553c6f.js"><link rel="prefetch" href="/assets/js/61.910c747c.js"><link rel="prefetch" href="/assets/js/62.11338b10.js"><link rel="prefetch" href="/assets/js/63.4db680cc.js"><link rel="prefetch" href="/assets/js/64.03470149.js"><link rel="prefetch" href="/assets/js/65.226aac33.js"><link rel="prefetch" href="/assets/js/66.ff242f26.js"><link rel="prefetch" href="/assets/js/67.4fa75535.js"><link rel="prefetch" href="/assets/js/68.8e397504.js"><link rel="prefetch" href="/assets/js/69.4e44158e.js"><link rel="prefetch" href="/assets/js/7.23c3e498.js"><link rel="prefetch" href="/assets/js/70.3c03822d.js"><link rel="prefetch" href="/assets/js/71.32e2c279.js"><link rel="prefetch" href="/assets/js/72.f5ac84af.js"><link rel="prefetch" href="/assets/js/73.64adb473.js"><link rel="prefetch" href="/assets/js/74.d7b550fe.js"><link rel="prefetch" href="/assets/js/75.be770e67.js"><link rel="prefetch" href="/assets/js/76.a7692266.js"><link rel="prefetch" href="/assets/js/77.fcafefb3.js"><link rel="prefetch" href="/assets/js/78.d1de0597.js"><link rel="prefetch" href="/assets/js/79.c4cbe623.js"><link rel="prefetch" href="/assets/js/8.561638da.js"><link rel="prefetch" href="/assets/js/80.45ff8ec4.js"><link rel="prefetch" href="/assets/js/81.a7006a2e.js"><link rel="prefetch" href="/assets/js/82.16b4b62c.js"><link rel="prefetch" href="/assets/js/83.bde15b26.js"><link rel="prefetch" href="/assets/js/84.9555f7e8.js"><link rel="prefetch" href="/assets/js/85.342c98a2.js"><link rel="prefetch" href="/assets/js/86.3dc6bedd.js"><link rel="prefetch" href="/assets/js/87.1ed60d78.js"><link rel="prefetch" href="/assets/js/88.a97aa37d.js"><link rel="prefetch" href="/assets/js/89.40d81536.js"><link rel="prefetch" href="/assets/js/9.4a2b0589.js"><link rel="prefetch" href="/assets/js/90.b0be239c.js"><link rel="prefetch" href="/assets/js/91.d1b597cd.js"><link rel="prefetch" href="/assets/js/92.0c0131a5.js"><link rel="prefetch" href="/assets/js/93.6a045b51.js"><link rel="prefetch" href="/assets/js/94.b9a23713.js"><link rel="prefetch" href="/assets/js/95.581789a6.js"><link rel="prefetch" href="/assets/js/96.cef1bc26.js"><link rel="prefetch" href="/assets/js/97.82bec4e2.js"><link rel="prefetch" href="/assets/js/98.e88e6b38.js"><link rel="prefetch" href="/assets/js/99.1c62b889.js">
    <link rel="stylesheet" href="/assets/css/0.styles.101e93c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="邱模建的博客" class="logo"> <span class="site-name can-hide">邱模建的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/JavaScript/实现拖拽.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/JavaScript/实现拖拽.html" class="nav-link">
  琐碎
</a></li></ul></div></div><div class="nav-item"><a href="https://leetcode-cn.com/u/2vgrNDufDX/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuogerenba" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/JavaScript/实现拖拽.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/JavaScript/实现拖拽.html" class="nav-link">
  琐碎
</a></li></ul></div></div><div class="nav-item"><a href="https://leetcode-cn.com/u/2vgrNDufDX/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuogerenba" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/React/React学习笔记.html" class="active sidebar-link">学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#一、react组件定义方式" class="sidebar-link">一、React组件定义方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_1-1、类组件" class="sidebar-link">1.1、类组件</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_1-2、函数式组件" class="sidebar-link">1.2、函数式组件</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_1-3、render的返回值" class="sidebar-link">1.3、render的返回值</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#二、组件的生命周期" class="sidebar-link">二、组件的生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_2-1-组件的生命周期函数" class="sidebar-link">2.1.组件的生命周期函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#三、组件通信" class="sidebar-link">三、组件通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_3-1父子组件通信-props" class="sidebar-link">3.1父子组件通信（props）</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_3-2兄弟间的通信-eventbus" class="sidebar-link">3.2兄弟间的通信——eventbus</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#四、setstate相关" class="sidebar-link">四、setState相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_4-1为什么使用setstate" class="sidebar-link">4.1为什么使用setState？</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_4-2setstate异步更新" class="sidebar-link">4.2setState异步更新？</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_4-3setstate同步更新" class="sidebar-link">4.3setState同步更新？</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_4-4setstate数据的合并" class="sidebar-link">4.4setState数据的合并</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_4-5setstate不可变数据的力量" class="sidebar-link">4.5setState不可变数据的力量</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#五、setstate性能优化" class="sidebar-link">五、setState性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_5-1react更新机制" class="sidebar-link">5.1React更新机制</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_5-2diff算法" class="sidebar-link">5.2Diff算法</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_5-3keys的优化" class="sidebar-link">5.3keys的优化</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_5-4-scu优化" class="sidebar-link">5.4.SCU优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#六、受控和非受控组件" class="sidebar-link">六、受控和非受控组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_6-1使用ref-类特有-函数组件没法用" class="sidebar-link">6.1使用ref(类特有，函数组件没法用)</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_6-2受控组件基本使用" class="sidebar-link">6.2受控组件基本使用</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_6-3ref的转发" class="sidebar-link">6.3ref的转发</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_6-4portals" class="sidebar-link">6.4Portals</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#七、高阶组件" class="sidebar-link">七、高阶组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_7-0高阶组件的作用" class="sidebar-link">7.0高阶组件的作用</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_7-1认识高阶函数" class="sidebar-link">7.1认识高阶函数</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_7-2高阶组件的应用-增强props" class="sidebar-link">7.2高阶组件的应用——增强props</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_7-3高阶组件的优点-缺点" class="sidebar-link">7.3高阶组件的优点/缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#八、react中的css" class="sidebar-link">八、React中的css</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_8-1内联样式" class="sidebar-link">8.1内联样式</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_8-2普通css" class="sidebar-link">8.2普通css</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_8-3css模块化" class="sidebar-link">8.3css模块化</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_8-4-css-in-js-推荐" class="sidebar-link">8.4 css in js 推荐</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_8-5-antd的使用" class="sidebar-link">8.5 antd的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#九、react过渡动画" class="sidebar-link">九、React过渡动画</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_9-1react-transition-group" class="sidebar-link">9.1react-transition-group</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#十、redux" class="sidebar-link">十、Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-1为什么要用redux" class="sidebar-link">10.1为什么要用redux？</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-2什么是redux" class="sidebar-link">10.2什么是Redux？</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-3redux简单使用" class="sidebar-link">10.3redux简单使用</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-4文件的划分" class="sidebar-link">10.4文件的划分</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-5代码的优雅化" class="sidebar-link">10.5代码的优雅化</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_10-6第三方库的使用" class="sidebar-link">10.6第三方库的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#十一、hooks" class="sidebar-link">十一、HOOKS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_11-1-usestate" class="sidebar-link">11.1.useState</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_11-2-useeffect的使用" class="sidebar-link">11.2.useEffect的使用</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_11-3-usecontext" class="sidebar-link">11.3.useContext</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_11-4-usereducer" class="sidebar-link">11.4.useReducer</a></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#_115-usecallback" class="sidebar-link">115.useCallback</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/React/React学习笔记.html#十二、react-router" class="sidebar-link">十二、react-router</a></li></ul></li><li><a href="/pages/React/redux学习.html" class="sidebar-link">Redux学习</a></li><li><a href="/pages/React/源码阅读.html" class="sidebar-link">源码阅读</a></li><li><a href="/pages/React/Fiber学习.html" class="sidebar-link">Fiber学习</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VUE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NODE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GIT教程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则表达式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实习遇到的问题及成长</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>腾讯工作的思考与总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>琐碎</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、react组件定义方式"><a href="#一、react组件定义方式" class="header-anchor">#</a> 一、React组件定义方式</h2> <h3 id="_1-1、类组件"><a href="#_1-1、类组件" class="header-anchor">#</a> 1.1、类组件</h3> <p>定义类组件必须满足以下要求：</p> <ul><li>类组件必须继承自 <code>React.Component</code></li> <li>类组件必须实现<code>render</code>函数</li></ul> <p><strong>类组件的特点</strong>：</p> <ul><li>constructor是可选的，通常在里面初始化数据</li> <li>this.state中维护的是组件内部的数据</li> <li><code>render()</code>是类组件唯一必实现的方法</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>我是类组件<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-2、函数式组件"><a href="#_1-2、函数式组件" class="header-anchor">#</a> 1.2、函数式组件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>我是<span class="token keyword">function</span>的组件<span class="token operator">:</span> App组件<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>counter<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>你好啊<span class="token punctuation">,</span>王小波<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数式组件的特点：</p> <ul><li><p>没有生命周期，会被更新挂载，但没有生命周期函数</p></li> <li><p>没有this对象</p></li> <li><p>没有内部状态</p></li></ul> <p><strong>通过HOOKS可以解决</strong></p> <h3 id="_1-3、render的返回值"><a href="#_1-3、render的返回值" class="header-anchor">#</a> 1.3、render的返回值</h3> <p>当<code>render</code>被调用时，他会检查<code>this.props</code>和<code>this.state</code>的变化并返回以下类型之一</p> <ul><li><strong>React元素</strong> <ul><li>通过JSX创建。</li> <li>例如，<code>&lt;div /&gt;</code>会被React渲染为DOM节点，<code>&lt;MyConponent /&gt;</code>会被React渲染为自定义组件；</li> <li>无论是<code>&lt;div /&gt;</code> 还是<code>&lt;MyConponent&gt;</code>都是React元素</li></ul></li> <li><strong>数组或者fragments:</strong> 使得render方法可以返回多个元素</li> <li><strong>Portals</strong>: 可以渲染子节点到不同的DOM子节点树中。</li> <li><strong>字符串||数值类型</strong>： 他们会在DOM中被渲染成文本节点</li> <li><strong>布尔值||null</strong>： 什么都不渲染</li></ul> <h2 id="二、组件的生命周期"><a href="#二、组件的生命周期" class="header-anchor">#</a> 二、组件的生命周期</h2> <h3 id="_2-1-组件的生命周期函数"><a href="#_2-1-组件的生命周期函数" class="header-anchor">#</a> 2.1.组件的生命周期函数</h3> <p><strong>constructor</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
</code></pre></div><p>如果不初始化<strong>state</strong>或不进行方法绑定，则不需要为组建实现构造函数</p> <p>constructor中通常只做两件事情：</p> <ul><li>通过给<code>this.state</code>赋值对象来初始化内部的state</li> <li>为事件绑定实例(this)</li></ul> <p><strong>componentDidMount</strong></p> <p><code>componentDidMount()</code>会在组件挂载后(插入DOM树中)立即执行。</p> <p>该函数通常执行的操作：</p> <ul><li>依赖于DOM操作可以在这里进行</li> <li>发送网络请求（官方建议）</li> <li>在此处添加订阅（在componentWillUNmount取消订阅）</li></ul> <p><strong>componentDidUpdate（）</strong></p> <p>该函数会在更新后被立即调用，但首次渲染的时候不会调用</p> <ul><li>当组件更新后，可以在此处对DOM进行操作</li> <li>如果对更新前后的props进行比较，可以在此处进行网络请求（例如，props未发生变化时，则不进行网络请求）</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userID <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>userID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 网络请求相关</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userID<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>componentWillUnmount</strong></p> <p><code>componentWillUnmount()</code>会在组件卸载及销毁之前直接调用</p> <ul><li>在此方法执行必要的清理操作；</li> <li>例如，清除timer，取消网络请求在<code>componentDidMount</code>中创建的订阅</li></ul> <h2 id="三、组件通信"><a href="#三、组件通信" class="header-anchor">#</a> 三、组件通信</h2> <h3 id="_3-1父子组件通信-props"><a href="#_3-1父子组件通信-props" class="header-anchor">#</a> 3.1父子组件通信（props）</h3> <p>父传子例子（类组件）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>子组件展示数据<span class="token operator">:</span><span class="token punctuation">{</span>name <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token operator">+</span> age <span class="token operator">+</span><span class="token string">&quot; &quot;</span> <span class="token operator">+</span> height<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child name<span class="token operator">=</span><span class="token string">&quot;qmj&quot;</span> age<span class="token operator">=</span><span class="token string">&quot;18&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;188&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>父传子例子(函数组件):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>name <span class="token operator">+</span> age <span class="token operator">+</span> height<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
Child<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> propTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
  age<span class="token operator">:</span> propTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  height<span class="token operator">:</span> propTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  names<span class="token operator">:</span> propTypes<span class="token punctuation">.</span>array
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child name<span class="token operator">=</span><span class="token string">&quot;qmj&quot;</span> age<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">}</span> height<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">188</span><span class="token punctuation">}</span> names<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">,</span><span class="token string">'bb'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2兄弟间的通信-eventbus"><a href="#_3-2兄弟间的通信-eventbus" class="header-anchor">#</a> 3.2兄弟间的通信——eventbus</h3> <p>一个全局对象</p> <p>安装：<code>yarn add events</code></p> <p>导入： <code>import { EventEmitter } from 'events'</code></p> <p>使用:</p> <div class="language- extra-class"><pre class="language-text"><code>const eventBus = new EventEmitter()

// 发射某个事件
emitEvent() {
	eventBus.emit('事件名',...参数)
}
// 接收事件
componentDidMount() {
	eventBus.addListener('事件名',callback)
}
componentWillUNmount() {
	eventBus.removeListener('事件名', callback)
}
</code></pre></div><p>推荐使用的生命周期:</p> <p>监听事件：componentDidMount</p> <p>卸载事件：componentWillUNmount</p> <ul><li><ul><li></li></ul></li></ul> <h2 id="四、setstate相关"><a href="#四、setstate相关" class="header-anchor">#</a> 四、setState相关</h2> <h3 id="_4-1为什么使用setstate"><a href="#_4-1为什么使用setstate" class="header-anchor">#</a> 4.1为什么使用setState？</h3> <p>因为直接通过this.state.属性直接修改的话，React是不知道数据发生变化的，因为他不像Vue2中的Object.defineProperty或者vue3中Proxy的方式去监听数据的变化。</p> <p>但本身并没有定义setState()，但是可以使用，因为setState是继承于Component。</p> <p>源码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">partialState<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span>
    <span class="token keyword">typeof</span> partialState <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span>
      <span class="token keyword">typeof</span> partialState <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">||</span>
      partialState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">'setState(...): takes an object of state variables to update or a '</span> <span class="token operator">+</span>
      <span class="token string">'function which returns an object of state variables.'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partialState<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'setState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 上面源码的意思表示partialState是传入最新的对象，类型是函数或者对象，null 否则报错</span>
</code></pre></div><h3 id="_4-2setstate异步更新"><a href="#_4-2setstate异步更新" class="header-anchor">#</a> 4.2setState异步更新？</h3> <p>下列代码：</p> <ul><li>打印出Helloworld</li> <li>说明在这里是异步更新的</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先前的Hello World</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为什么setState是异步的？</p> <ul><li>该问题在github上讨论激烈，React核心成员兼Redux作者给出了相应的回答</li> <li>https://github.com/facebook/react/issues/11527#issuecomment-360199710；</li></ul> <p>我对其回答做一个简单的总结：</p> <ul><li><p><code>setState</code>设计为异步，可以显著的提升性能；</p></li> <li><ul><li>如果每次调用 setState都进行一次更新，那么意味着render函数会被频繁调用，界面重新渲染，这样效率是很低的；</li> <li>最好的办法应该是获取到多个更新，之后进行批量更新；</li></ul></li> <li><p>如果同步更新了state，但是还没有执行render函数，那么state和props不能保持同步；</p></li> <li><ul><li>state和props不能保持一致性，会在开发中产生很多的问题；</li></ul></li></ul> <p>如何获取前面更新后的值？</p> <ul><li>上面源码写的很清楚，setState有两个参数，第二个参数callback可以获取到最新的值。</li> <li>格式如下：<code>setState(partialState, callback)</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你好啊,李银河</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，我们也可以在生命周期函数拿到最新的值：</p> <div class="language- extra-class"><pre class="language-text"><code>componentDidUpdate(prevProps, provState, snapshot) {
	console.log(this.state.message);
}
</code></pre></div><h3 id="_4-3setstate同步更新"><a href="#_4-3setstate同步更新" class="header-anchor">#</a> 4.3setState同步更新？</h3> <p>setTime中同步更新：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你好啊,李银河</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>原生DOM事件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> btnEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  btnEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你好啊,李银河</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其实分成两种情况：</p> <ul><li>在组件生命周期或React合成事件中，setState是异步；</li> <li>在setTimeout或者原生dom事件中，setState是同步；</li></ul> <p>React内部其实是通过一个函数来确定的：enqueueSetState部分实现（react-reconciler/ReactFiberClassComponent.js） :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token parameter">inst<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 会根据React上下文计算一个当前时间</span>
  <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token function">requestCurrentTimeForUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> suspenseConfig <span class="token operator">=</span> <span class="token function">requestCurrentSuspenseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 这个函数会返回当前是同步还是异步更新（准确的说是优先级）</span>
  <span class="token keyword">const</span> expirationTime <span class="token operator">=</span> <span class="token function">computeExpirationForFiber</span><span class="token punctuation">(</span>
    currentTime<span class="token punctuation">,</span>
    fiber<span class="token punctuation">,</span>
    suspenseConfig<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>expirationTime<span class="token punctuation">,</span> suspenseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Sync是优先级最高的，即创建就更新；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  currentTime: ExpirationTime,
  fiber: Fiber,
  suspenseConfig: null | SuspenseConfig,
): ExpirationTime {
  const mode = fiber.mode;
  if ((mode &amp; BlockingMode) === NoMode) {
    return Sync; // 返回同步
  }

  const priorityLevel = getCurrentPriorityLevel();
  if ((mode &amp; ConcurrentMode) === NoMode) {
    return priorityLevel === ImmediatePriority ? Sync : Batched; //返回同步或者异步
  }
</code></pre></div><h3 id="_4-4setstate数据的合并"><a href="#_4-4setstate数据的合并" class="header-anchor">#</a> 4.4setState数据的合并</h3> <h4 id="_4-4-1数据的合并"><a href="#_4-4-1数据的合并" class="header-anchor">#</a> 4.4.1数据的合并</h4> <p>假如我们有这样的数据：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;qmj&quot;</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们需要更新message：</p> <ul><li>我通过setState去修改message，是不会对name产生影响的；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>changeText() {
  this.setState({
    message: &quot;你好啊,李银河&quot;
  });
}
</code></pre></div><p>为什么不会产生影响？源码内部对<strong>原对象</strong>和<strong>新对象</strong>进行了合并：</p> <ul><li>事实上就是使用 <code>Object.assign(target, ...sources)</code> 来完成的；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> partialStete<span class="token punctuation">)</span> <span class="token comment">// 目标， 前一个state，新state</span>
</code></pre></div><h4 id="_4-4-1多个setstate的合并"><a href="#_4-4-1多个setstate的合并" class="header-anchor">#</a> 4.4.1多个setState的合并</h4> <p>如state里面有一个counter为0，一个点击事件同时setState三次让它+1，</p> <ul><li>结果是以最后一次为结果，还是1</li> <li>因为他会对多个state进行合并</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>其实在源码的processUpdateQueue中有一个do...while循环，就是从队列中取出多个state进行合并的；</p> <p>但如果想不合并(累加)呢？就可以把第一个参数改为函数了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-5setstate不可变数据的力量"><a href="#_4-5setstate不可变数据的力量" class="header-anchor">#</a> 4.5setState不可变数据的力量</h3> <p>newState和oldState不能是一样的</p> <p>原因：这样的话SCU就没有任何意义，因为其内部判断是根据新旧值(地址值)来判断的。这样的话，SCU内部判断永远返回的是false，就无法重新render</p> <p><strong>错误的做法：</strong></p> <ul><li>新旧state都是同一个地址值</li> <li>不进行SCU其实可以，但开发中不要这样做</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const newData = {name: 'tom', age: 30}
this.state.friends.push(newData)
this.setState({
	friends: this.state.friends
})
</code></pre></div><p><strong>推荐做法：</strong></p> <ul><li>可以进行SCU优化，这两个对象的地址值是不一样的</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const newFriends = [...this.state.friends]
newFriends.push({name: 'tom', age: 30})
this.setState({
	friends: newFriends
})
</code></pre></div><h2 id="五、setstate性能优化"><a href="#五、setstate性能优化" class="header-anchor">#</a> 五、setState性能优化</h2> <h3 id="_5-1react更新机制"><a href="#_5-1react更新机制" class="header-anchor">#</a> 5.1React更新机制</h3> <p>React的渲染流程非常简单：</p> <div class="language- extra-class"><pre class="language-text"><code>JSX -&gt; 虚拟DOM -&gt; 真实DOM
</code></pre></div><p>那么React的更新流程呢？</p> <div class="language- extra-class"><pre class="language-text"><code>props/state改变 -&gt; render函数重新执行 -&gt; 产生新的DOM数-&gt;

新旧DOM进行diff -&gt; 计算差异进行更新 -&gt; 更新到真实的DOM`
</code></pre></div><p>React在props/state改变时，会调用React的render的方法，会创建一颗不同的树。</p> <p>React需要基于这两颗不同的树之间的差别来判断如何有效的更新UI：</p> <p>算法进行了优化成O(n):</p> <ul><li>同层节点之间比较，不会跨节点</li> <li>不同类型的节点，产生不同的树结构(如：div&gt;span，就会生成全新的字树)</li> <li>通过key指定哪些节点在不同的渲染下保持稳定</li></ul> <h3 id="_5-2diff算法"><a href="#_5-2diff算法" class="header-anchor">#</a> 5.2Diff算法</h3> <h4 id="_5-2-1对比不同类型的元素"><a href="#_5-2-1对比不同类型的元素" class="header-anchor">#</a> 5.2.1对比不同类型的元素</h4> <p>当节点为不同的元素，React会拆卸原有的树，并且建立起新的树：</p> <ul><li>当一个元素从 <code>a</code> 变成 <code>img</code>，从 <code>Article</code> 变成 <code>Comment</code>，或从 <code>Button</code> 变成 <code>div</code> 都会触发一个完整的重建流程；</li> <li>当卸载一棵树时，对应的DOM节点也会被销毁，组件实例将执行<code>componentWillUnmount()</code> 方法；</li> <li>当建立一棵新的树时，对应的 DOM 节点会被创建以及插入到 DOM 中，组件实例将执行 <code>componentWillMount()</code> 方法，紧接着 <code>componentDidMount()</code> 方法；</li></ul> <p>比如下面的代码更改：</p> <ul><li>React 会销毁 <code>Counter</code> 组件并且重新装载一个新的组件，而不会对Counter进行复用；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt;
  &lt;Counter /&gt;
&lt;/div&gt;

&lt;span&gt;
  &lt;Counter /&gt;
&lt;/span&gt;
</code></pre></div><h4 id="_5-2-2-对比同一类型的元素"><a href="#_5-2-2-对比同一类型的元素" class="header-anchor">#</a> 5.2.2 对比同一类型的元素</h4> <p>当比对两个相同类型的 React 元素时，React 会保留 DOM 节点，仅比对及更新有改变的属性。</p> <p>比如下面的代码更改：</p> <ul><li>通过比对这两个元素，React 知道只需要修改 DOM 元素上的 <code>className</code> 属性；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;div className=&quot;before&quot; title=&quot;stuff&quot; /&gt;

&lt;div className=&quot;after&quot; title=&quot;stuff&quot; /&gt;
</code></pre></div><p>如果是同类型的组件元素：</p> <ul><li>组件会保持不变，React会更新该组件的props，并且调用<code>componentWillReceiveProps()</code>和 <code>componentWillUpdate()</code> 方法；</li> <li>下一步，调用 <code>render()</code> 方法，diff 算法将在之前的结果以及新的结果中进行递归；</li></ul> <h4 id="_5-2-3对子节点进行递归"><a href="#_5-2-3对子节点进行递归" class="header-anchor">#</a> 5.2.3对子节点进行递归</h4> <p>在默认条件下，当递归 DOM 节点的子元素时，React 会同时遍历两个子元素的列表；当产生差异时，生成一个 mutation。</p> <p>我们来看一下在最后插入一条数据的情况：</p> <ul><li>前面两个比较是完全相同的，所以不会产生mutation；</li> <li>最后一个比较，产生一个mutation，将其插入到新的DOM树中即可；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>first<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>second<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>first<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>second<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>third<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>但是如果我们是在中间插入一条数据：</p> <ul><li>React会对每一个子元素产生一个mutation，而不是保持 <code>星际穿越</code>和<code>盗梦空间</code>的不变；</li> <li>这种低效的比较方式会带来一定的性能问题；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>星际穿越<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>盗梦空间<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>大话西游<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>星际穿越<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>盗梦空间<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><h3 id="_5-3keys的优化"><a href="#_5-3keys的优化" class="header-anchor">#</a> 5.3keys的优化</h3> <p>在遍历列表的时候，总会 提示警告，需要加入key值</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      movies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;星际穿越&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;盗梦空间&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>电影列表<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertMovie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>插入数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">insertMovie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式一：在最后位置插入数据</p> <ul><li>这种情况，有无key意义不大</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">insertMovie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newMovies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>movies<span class="token punctuation">,</span> <span class="token string">&quot;大话西游&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    movies<span class="token operator">:</span> newMovies
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式二：在前面插入数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">insertMovie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newMovies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;大话西游&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>movies<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    movies<span class="token operator">:</span> newMovies
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当子元素(这里的li)拥有 key 时，React 使用 key 来匹配原有树上的子元素以及最新树上的子元素：</p> <ul><li>在下面这种场景下，key为111和222的元素仅仅进行位移，不需要进行任何的修改；</li> <li>将key为333的元素插入到最前面的位置即可；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;111&quot;</span><span class="token operator">&gt;</span>星际穿越<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;222&quot;</span><span class="token operator">&gt;</span>盗梦空间<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;333&quot;</span><span class="token operator">&gt;</span>Connecticut<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;111&quot;</span><span class="token operator">&gt;</span>星际穿越<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">&quot;222&quot;</span><span class="token operator">&gt;</span>盗梦空间<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>key的注意事项：</p> <ul><li>key应该是唯一的；</li> <li>key不要使用随机数（随机数在下一次render时，会重新生成一个数字）；</li> <li>使用index作为key，对性能是没有优化的；</li></ul> <h3 id="_5-4-scu优化"><a href="#_5-4-scu优化" class="header-anchor">#</a> 5.4.SCU优化</h3> <h4 id="_5-4-1render函数的调用"><a href="#_5-4-1render函数的调用" class="header-anchor">#</a> 5.4.1render函数的调用</h4> <p>看一个例子：</p> <ul><li>点击事件发生时App的render()被调用</li> <li>App的render被调用，从而造成所有子组件的render被调用</li> <li>造成性能上的浪费</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Header Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Header<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Main Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Banner<span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ProductList<span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Banner Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Banner<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ProductList Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>商品<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>商品<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>商品<span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>商品<span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>商品<span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Footer Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Footer<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;App Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前计数<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Header<span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Main<span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Footer<span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>思考：</p> <ul><li>很多组件没必要重新render</li> <li>调用render只有一个前提：依赖数据(state/props)发生改变时，再调用自己的render</li></ul> <p>如何控制render？</p> <ul><li>通过<code>shouldComponentUpdate</code>方法即可；</li></ul> <h4 id="_5-4-2-shouldcomponentupdate"><a href="#_5-4-2-shouldcomponentupdate" class="header-anchor">#</a> 5.4.2.shouldComponentUpdate</h4> <p>该方法是一个生命周期，有参数，且有返回值：</p> <ul><li><p>该方法有两个参数：</p></li> <li><ul><li>参数一：nextProps 修改之后，最新的props属性</li> <li>参数二：nextState 修改之后，最新的state属性</li></ul></li> <li><p>该方法返回值是一个boolean类型</p></li> <li><ul><li>返回值为true，那么就需要调用render方法；</li> <li>返回值为false，那么久不需要调用render方法；</li> <li>默认返回的是true，也就是只要state发生改变，就会调用render方法</li></ul></li></ul> <p>比如我们在App中增加一个message属性：</p> <ul><li>jsx中并没有依赖这个message，那么它的改变不应该引起重新渲染；</li> <li>但是因为render监听到state的改变，就会重新render，所以最后render方法还是被重新调用了；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;App Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前计数<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>改变文本<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Header<span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Main<span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Footer<span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;你好啊,李银河&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-4-3-purecomponent和memo"><a href="#_5-4-3-purecomponent和memo" class="header-anchor">#</a> 5.4.3. PureComponent和memo</h4> <p>类组件可以使用pureComponent，原理是什么呢？</p> <ul><li>对props和state进行浅层比较(源码在 react/ReactBaseClasses.js )</li></ul> <p>函数式组件使用memo</p> <ul><li>使用memo对之前的子组件进行包裹</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> MemoHeader <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Header Render 被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Header<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>原理(react/memo.js)</p> <h2 id="六、受控和非受控组件"><a href="#六、受控和非受控组件" class="header-anchor">#</a> 六、受控和非受控组件</h2> <h3 id="_6-1使用ref-类特有-函数组件没法用"><a href="#_6-1使用ref-类特有-函数组件没法用" class="header-anchor">#</a> 6.1使用ref(类特有，函数组件没法用)</h3> <p>在React开发中，不建议直接操作DOM，使用ref</p> <p>三种方式：</p> <ul><li><p>ref等于一个字符串</p> <ul><li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>titleRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello React</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变文本</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
changeText() </span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>titleRef<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token punctuation">}</span><span class="token plain-text">
</span></code></pre></div></li></ul></li> <li><p>为一个对象(推荐)</p> <ul><li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRef<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>titleRef <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello React</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变文本</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
changeText() </span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token punctuation">}</span><span class="token plain-text">
</span></code></pre></div></li></ul></li> <li><p>为一个函数</p> <ul><li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>titleEl <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>titleEl <span class="token operator">=</span> arg<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello React</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">

</span></code></pre></div></li></ul></li></ul> <h3 id="_6-2受控组件基本使用"><a href="#_6-2受控组件基本使用" class="header-anchor">#</a> 6.2受控组件基本使用</h3> <h3 id="_6-3ref的转发"><a href="#_6-3ref的转发" class="header-anchor">#</a> 6.3ref的转发</h3> <ul><li>原因，函数式组件不能用ref</li></ul> <p>现有代码：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 类组件可以使用ref</span>
<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>homeRef<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">// 函数式组件不能用ref</span>
<span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Profile</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>profileRef<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span>  <span class="token comment">// 直接给出警告</span>
</code></pre></div><p>但如果想要获取到函数式组件的<code>h2</code>标签呢？</p> <ul><li>使用forwardRef高阶组件（函数），需要从react引入</li> <li>forwardRef有两个参数，第一个props，第二个ref，然后直接在ref={ref}即可</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> Profile <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Profile</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>        

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>profileRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>

</code></pre></div><h3 id="_6-4portals"><a href="#_6-4portals" class="header-anchor">#</a> 6.4Portals</h3> <h4 id="_6-4-1portals出现的原因"><a href="#_6-4-1portals出现的原因" class="header-anchor">#</a> 6.4.1Portals出现的原因</h4> <p>开发有些情况的希望组件独立于父组件甚至整个DOM，例如：</p> <ul><li>在一个组件里面点击事件后希望有一个弹窗显示与整个窗口的中间，但组件是很小的。</li></ul> <h4 id="_6-4-2portals的使用"><a href="#_6-4-2portals的使用" class="header-anchor">#</a> 6.4.2Portals的使用</h4> <p>Portals是ReactDOM里面的方法，可以将子节点渲染到存在于父组件外的DOM节点</p> <ul><li>第一个参数(child)是任何可渲染的React子元素，例如一个子元素，字符串或者fragment</li> <li>第二个参数（container）是一个DOM元素</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><h2 id="七、高阶组件"><a href="#七、高阶组件" class="header-anchor">#</a> 七、高阶组件</h2> <h3 id="_7-0高阶组件的作用"><a href="#_7-0高阶组件的作用" class="header-anchor">#</a> 7.0高阶组件的作用</h3> <ul><li>1.将一些没有技术含量的操作组件的工作过程封装成一个函数，比如给每个组件添加个属性</li> <li>共享Context过程代码繁琐，可以用高阶组件封装具体过程</li></ul> <h3 id="_7-1认识高阶函数"><a href="#_7-1认识高阶函数" class="header-anchor">#</a> 7.1认识高阶函数</h3> <p>什么是高阶函数？满足以下条件之一：</p> <ul><li>接收一个或多个函数作为输入</li> <li>输出一个函数</li> <li>例如：filter，map，reduce</li></ul> <p>那什么是高阶组件呢？</p> <ul><li>英文名<strong>Higher-Order Components</strong>,简称HOC</li> <li>官方定义：<strong>高阶组件是参数为组件，返回值为新组件的函数</strong></li></ul> <p>高阶组件调用：</p> <div class="language- extra-class"><pre class="language-text"><code>const EnhancedComponent = higherOrderComponent(WrappedComponent);
</code></pre></div><p>高阶组件编写:</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">higherOrderComponent</span><span class="token punctuation">(</span><span class="token parameter">WrapperComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">NewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrapperComponent</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在开发者工具看到的组件的嵌套是写死的：</p> <ul><li>NewComponent&gt;WrapperComponent</li></ul> <p>如果想要改成自己想要的名字呢？</p> <ul><li>NewComponent.display = &quot;qmj&quot;</li> <li>qmj&gt;WrapperComponent</li></ul> <p>一个完整的高阶组件代码：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">higherOrderComponent</span><span class="token punctuation">(</span><span class="token parameter">WrapperComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">NewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrapperComponent</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        App
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">higherOrderComponent</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-2高阶组件的应用-增强props"><a href="#_7-2高阶组件的应用-增强props" class="header-anchor">#</a> 7.2高阶组件的应用——增强props</h3> <h4 id="_7-2-1-props的增强"><a href="#_7-2-1-props的增强" class="header-anchor">#</a> 7.2.1. props的增强</h4> <p><strong>不修改原有代码的情况下，添加新的props</strong></p> <ul><li>假如要添加公共属性的话，原来是要在每个组件后面添加女</li> <li>使用高阶组件的话，只需要在函数中 { region = '江西'} 就可以给所有通过该函数创建的组件添加该属性</li></ul> <p>假如我们有如下案例：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">EnhanceProps</span><span class="token punctuation">(</span><span class="token parameter">WrapperComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrapperComponent</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>江西<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home:</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">昵称：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  年龄: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 地区: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>region<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">About</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About:</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">昵称：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  年龄: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 地区: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>region<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> EnhanceHome <span class="token operator">=</span> <span class="token function">EnhanceProps</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
<span class="token keyword">const</span> EnhanceAbout <span class="token operator">=</span> <span class="token function">EnhanceProps</span><span class="token punctuation">(</span>About<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        App: </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EnhanceHome</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qmj<span class="token punctuation">&quot;</span></span> <span class="token attr-name">age</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EnhanceAbout</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>kobe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">age</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">28</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>利用高阶组件来共享Context</strong></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent<span class="token punctuation">,</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  nickname<span class="token operator">:</span> <span class="token string">&quot;默认&quot;</span><span class="token punctuation">,</span>
  level<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">withUser</span><span class="token punctuation">(</span><span class="token parameter">WrapperCpn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>
          <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrapperCpn</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">value</span><span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> nickname<span class="token punctuation">,</span> level <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Header </span><span class="token punctuation">{</span><span class="token string">&quot;昵称:&quot;</span> <span class="token operator">+</span> nickname <span class="token operator">+</span> <span class="token string">&quot;等级:&quot;</span> <span class="token operator">+</span> level<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">Footer</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> nickname<span class="token punctuation">,</span> level <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Footer </span><span class="token punctuation">{</span><span class="token string">&quot;昵称:&quot;</span> <span class="token operator">+</span> nickname <span class="token operator">+</span> <span class="token string">&quot;等级:&quot;</span> <span class="token operator">+</span> level<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> UserHeader <span class="token operator">=</span> <span class="token function">withUser</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> UserFooter <span class="token operator">=</span> <span class="token function">withUser</span><span class="token punctuation">(</span>Footer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> nickname<span class="token operator">:</span> <span class="token string">&quot;why&quot;</span><span class="token punctuation">,</span> level<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserHeader</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserFooter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-2-2渲染判断鉴权"><a href="#_7-2-2渲染判断鉴权" class="header-anchor">#</a> 7.2.2渲染判断鉴权</h4> <p>在开发中，我们可能遇到这样的场景：</p> <ul><li>某些页面是必须用户登录成功才能进行进入；</li> <li>如果用户没有登录成功，那么直接跳转到登录页面；</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">// 高阶组件</span>
<span class="token keyword">function</span> <span class="token function">WithAuth</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>isLogin<span class="token punctuation">}</span> <span class="token operator">=</span> props
    <span class="token keyword">return</span> isLogin<span class="token operator">?</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token operator">&lt;</span>Login <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 购物车</span>
<span class="token keyword">class</span> <span class="token class-name">Cart</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>购物车<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>登录界面<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> WithCart <span class="token operator">=</span> <span class="token function">WithAuth</span><span class="token punctuation">(</span>Cart<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>WithCart isLogin<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_7-2-3共享context"><a href="#_7-2-3共享context" class="header-anchor">#</a> 7.2.3共享Context</h4> <h4 id="_7-2-4生命周期劫持"><a href="#_7-2-4生命周期劫持" class="header-anchor">#</a> 7.2.4生命周期劫持</h4> <h3 id="_7-3高阶组件的优点-缺点"><a href="#_7-3高阶组件的优点-缺点" class="header-anchor">#</a> 7.3高阶组件的优点/缺点</h3> <p>优点：</p> <ul><li>早期使用mixin，但已经不再推荐</li> <li>可以对代码进行优雅的处理</li> <li>可以减少重复的代码</li></ul> <p>缺点：</p> <ul><li>HOC需要在原组件上进行包裹或者嵌套，大量使用HOC会造成很多嵌套，让代码试调变得困难</li> <li>HOC可以劫持props，在不遵守约定的情况下造成冲突</li></ul> <p>解决：</p> <ul><li>HOOKS</li> <li>hooks解决了 this指向问题，hoc大量嵌套问题</li></ul> <h2 id="八、react中的css"><a href="#八、react中的css" class="header-anchor">#</a> 八、React中的css</h2> <h3 id="_8-1内联样式"><a href="#_8-1内联样式" class="header-anchor">#</a> 8.1内联样式</h3> <p>优点：</p> <ul><li>样式之间不会有冲突</li> <li>可以动态获取当前state的状态</li></ul> <p>缺点：</p> <ul><li>没有代码提示</li> <li>大量代码书写在一个文件，看起来混乱</li> <li>无法书写伪类/伪元素</li> <li>书写要使用驼峰</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">'orange'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>fontSize<span class="token operator">:</span> <span class="token string">&quot;50px&quot;</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是标题</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>pStyle<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是一段文字</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-2普通css"><a href="#_8-2普通css" class="header-anchor">#</a> 8.2普通css</h3> <p>创建style文件，引入组件中即可</p> <p>缺点：</p> <ul><li>会产生层叠，当类名一样的时候</li> <li>从app里面导入，权重很高，可能会覆盖全部样式</li></ul> <h3 id="_8-3css模块化"><a href="#_8-3css模块化" class="header-anchor">#</a> 8.3css模块化</h3> <p>在普通css的基础上把文件名改成 style.module.css</p> <p>缺点：</p> <ul><li>使用类名的时候不能用连接符</li> <li>所有的className都使用{style.className}来书写</li> <li>不方便动态修改样式，依然要使用内联的方式</li></ul> <p>使用过程：</p> <ul><li>在style.module.css里面书写样式</li> <li>导入样式</li> <li>以对象的方式使用样式</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> homeStyle <span class="token keyword">from</span> <span class="token string">'./style.module.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>homeStyle<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是home组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-4-css-in-js-推荐"><a href="#_8-4-css-in-js-推荐" class="header-anchor">#</a> 8.4 css in js 推荐</h3> <blockquote><p>事实上就是把样式也写到JS中，这样可以方便的使用JavaScript的状态，all in js</p></blockquote> <p>优点：</p> <ul><li>css in js具有预处理器的功能，样式嵌套，函数定义，逻辑复用，动态修改状态</li> <li>这是目前最受欢迎的方案</li></ul> <p>目前css in js 的库</p> <ul><li>styled-components</li> <li>emotion</li> <li>glamorous</li></ul> <h4 id="认识styled-components"><a href="#认识styled-components" class="header-anchor">#</a> 认识styled-components</h4> <p>安装： <code>yarn styled-components</code></p> <p>导入： <code>import styled from 'styled-components'</code></p> <p>书写：</p> <ul><li>字符串模板解析</li> <li>div是个函数，span，a等等都可以</li> <li>返回的是一个具有字体大小50px，颜色红的组件</li> <li>可以和less一样样式嵌套</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// styled.js</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> HomeWrapper <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  font-size: 50px;
  color: red;

  .banner {
    background-color: blue;
  }
</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// home.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  HomeWrapper
 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./style&quot;</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HomeWrapper</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        app
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>banner<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是home组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">HomeWrapper</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="解决了预处理器动态样式问题"><a href="#解决了预处理器动态样式问题" class="header-anchor">#</a> 解决了预处理器动态样式问题</h4> <ul><li>可以自己定义变量，通过${箭头函数获取}</li> <li>可以获取state里面的样式属性</li> <li>传入自定义组件里面，然后通过${箭头函数}获取</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">//自定义变量</span>
<span class="token keyword">const</span> MJInput <span class="token operator">=</span> styled<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  placeholder<span class="token operator">:</span> <span class="token string">'coderqmj'</span><span class="token punctuation">,</span>
  bColor<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  background-color: lightblue;
  border-color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>bColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 获取state里面的动态样式</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
<span class="token keyword">const</span> MJInput <span class="token operator">=</span> styled<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  placeholder<span class="token operator">:</span> <span class="token string">'coderqmj'</span><span class="token punctuation">,</span>
  bColor<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  background-color: lightblue;
  border-color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>bColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
  color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token parameter">props</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">About</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;orange&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MJInput</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>color<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="加上属性的写法"><a href="#加上属性的写法" class="header-anchor">#</a> 加上属性的写法</h4> <ul><li>通过styled-components创建出来的组件直接能加上</li> <li>通过函数</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 方法一：</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MJInput</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">// 方法二:</span>
<span class="token keyword">const</span> MJInput <span class="token operator">=</span> styled<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  placeholder<span class="token operator">:</span> <span class="token string">'coderqmj'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  background-color: lightblue;
</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><h4 id="传递参数"><a href="#传递参数" class="header-anchor">#</a> 传递参数</h4> <ul><li>再定义好的样式组件里面传入</li> <li>在style.js里面对应的样式组件里面通过props获取</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 组件里面</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BannerWrapper</span></span> <span class="token attr-name">img</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>bgImage<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BannerWrapper</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// style.js里面</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> BannerWrapper <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  background: url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>bgImage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) center center/6000px;
</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><h3 id="_8-5-antd的使用"><a href="#_8-5-antd的使用" class="header-anchor">#</a> 8.5 antd的使用</h3> <p>安装：<code>yarn add antd</code>  矢量图：<code>yarn add @ant-design/icons</code></p> <p>使用monent库：<code>yarn add moment</code></p> <p>导入：</p> <p>样式引用：<code>import 'antd/dist/antd.css'</code> 在App中</p> <h4 id="按需导入"><a href="#按需导入" class="header-anchor">#</a> 按需导入</h4> <p>安装craco：<code>yarn add craco</code></p> <p>修改packpage的scripts：都改为 carco, 他会读取craco.config.js里面的配置</p> <p>他会和webpack里面的配置进行合并</p> <h2 id="九、react过渡动画"><a href="#九、react过渡动画" class="header-anchor">#</a> 九、React过渡动画</h2> <h3 id="_9-1react-transition-group"><a href="#_9-1react-transition-group" class="header-anchor">#</a> 9.1react-transition-group</h3> <ul><li>在开发中，我们给一个组件的显示和消失添加某种过渡动画，可以很好的增加用户体验。</li> <li>原生css可以实现这些过渡动画，但是React社区为我们提供了react-transition-group来完成过渡动画</li></ul> <p>安装：</p> <p>yarn add react-transition-group</p> <p>优点：</p> <ul><li>体积小，不会给项目增加负担</li> <li>提供API，使用方便</li></ul> <h4 id="提供的四个组件"><a href="#提供的四个组件" class="header-anchor">#</a> 提供的四个组件</h4> <ul><li><strong>Transition</strong> <ul><li>该组件是一个和平台无关的组件</li> <li>在前端开发中，一般使用CSSTransition</li></ul></li> <li><strong>CSSTransition</strong> <ul><li>通常使用这个来完成过渡动画</li></ul></li> <li><strong>SwitchTransition</strong> <ul><li>两个组件显示和隐藏切换时，使用该组件</li></ul></li> <li><strong>TransitionGroup</strong> <ul><li>将多个东华组件包裹在其中，一般用于列表中元素的动画</li></ul></li></ul> <h2 id="十、redux"><a href="#十、redux" class="header-anchor">#</a> 十、Redux</h2> <h3 id="_10-1为什么要用redux"><a href="#_10-1为什么要用redux" class="header-anchor">#</a> 10.1为什么要用redux？</h3> <p>javascript开发的应用程序，变得很复杂了</p> <ul><li>管理的状态很多，复杂</li></ul> <p>管理不断变化的state非常困难：</p> <ul><li>状态管理会互相存在依赖，一个状态变化会引起另一个状态的变化，View页面也有可能会引起状态的变化</li> <li>当应用程序复杂时，state在什么时候，什么原因而发生了变化，变得难以控制和追踪</li></ul> <p>redux就是一个帮我们管理状态的容器：redux是JavaScript的状态容器，提供了可预测的状态管理</p> <h3 id="_10-2什么是redux"><a href="#_10-2什么是redux" class="header-anchor">#</a> 10.2什么是Redux？</h3> <h4 id="_10-2redux核心理念-store"><a href="#_10-2redux核心理念-store" class="header-anchor">#</a> 10.2Redux核心理念——store</h4> <h4 id="_10-3redux核心理念-action"><a href="#_10-3redux核心理念-action" class="header-anchor">#</a> 10.3Redux核心理念——action</h4> <p>Redux要求我们通过action来更新数据：</p> <ul><li>所有数据的变化，必须通过派发dispath action来更新</li> <li>action是一个普通的JavaScript对象，用来描述这次更新的type和content</li></ul> <h4 id="_10-4redux核心理念-reducer"><a href="#_10-4redux核心理念-reducer" class="header-anchor">#</a> 10.4Redux核心理念——reducer</h4> <h4 id="_10-5redux三大原则"><a href="#_10-5redux三大原则" class="header-anchor">#</a> 10.5Redux三大原则</h4> <h4 id="单一数据源"><a href="#单一数据源" class="header-anchor">#</a> 单一数据源</h4> <ul><li>整个应用程的state都被存储在一颗object tree中，并且这个object tree只存储在一个store中</li> <li>单一数据源可以让整个应用程序的state变的方便维护、追踪、修改</li></ul> <h4 id="state是只读的"><a href="#state是只读的" class="header-anchor">#</a> state是只读的</h4> <ul><li>修改state的方法一定是触发action，不要通过其他任何地方来修改state</li> <li>确保view或网络请求都不能直接修改state，他们只能通过action来描述自己想要如何修改state</li> <li>保证了修改都被集中化处理，并且按照严格的顺序来执行，所以不用担心race condition问题</li></ul> <h3 id="_10-3redux简单使用"><a href="#_10-3redux简单使用" class="header-anchor">#</a> 10.3redux简单使用</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1.导入Redux</span>
<span class="token keyword">const</span> redux <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span>


<span class="token comment">// 初始化数据</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token comment">// reducer</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;INCREMENT&quot;</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span>
      <span class="token operator">...</span> 类似于上面
      <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>

<span class="token comment">// store 需要传入reducer</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
<span class="token comment">// action</span>
<span class="token keyword">const</span> action1 <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> action2 <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> action3 <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'ADD_NUMBER'</span><span class="token punctuation">,</span> num<span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> action4 <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'SUB_NUMBER'</span><span class="token punctuation">,</span> num<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 派发action, dispatch内部会执行reducer函数</span>
store<span class="token punctuation">.</span><span class="token function">dispath</span><span class="token punctuation">(</span>action1<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispath</span><span class="token punctuation">(</span>action2<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispath</span><span class="token punctuation">(</span>action3<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispath</span><span class="token punctuation">(</span>action4<span class="token punctuation">)</span>
</code></pre></div><h3 id="_10-4文件的划分"><a href="#_10-4文件的划分" class="header-anchor">#</a> 10.4文件的划分</h3> <p><strong>store/index.js</strong></p> <ul><li>目的是导出store</li> <li>需要redux里面的createStore</li> <li>需要reducer作为参数传入createStore</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><p><strong>store/constants.js</strong></p> <ul><li>定义一些action.type的常量，防止写错</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_NUMBER</span> <span class="token operator">=</span> <span class="token string">&quot;ADD_NUMBER&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SUB_NUMBER</span> <span class="token operator">=</span> <span class="token string">&quot;SUB_NUMBER&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>store/reducer.js</strong></p> <ul><li>用于进行相关的数据操作</li> <li>需要导入常量，查找操作的类型</li> <li>需要初始化数据inititalState</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  <span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span>
  <span class="token constant">SUB_NUMBER</span>
 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./constants&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> inititalState <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> inititalState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_NUMBER</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>num <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token constant">SUB_NUMBER</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> action<span class="token punctuation">.</span>num <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer
</code></pre></div><p><strong>store/actionCreators.js</strong></p> <ul><li>目的是定义action的类型，和其他数据</li> <li>类型用常量定义</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  <span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span>
  <span class="token constant">SUB_NUMBER</span>  
 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./constants&quot;</span><span class="token punctuation">;</span>

 <span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>
     type<span class="token operator">:</span> <span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span>
     num
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">subAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">SUB_NUMBER</span><span class="token punctuation">,</span>
    num
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>组件.js</strong></p> <ul><li>需要actions，用于传入dispatch</li> <li>需要store，用于获取数据</li> <li>需要生命周期函数里面订阅redux状态变化，更新state</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  addAction<span class="token punctuation">,</span>
  subAction
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store/actionCreators&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      counter<span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribue <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        counter<span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>当前计数<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addAction</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">subNumber</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">subAction</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_10-5代码的优雅化"><a href="#_10-5代码的优雅化" class="header-anchor">#</a> 10.5代码的优雅化</h3> <p>上面的代码如果另外一个组件做一些相似逻辑的操作，那么又要重新写一遍，有没有办法将代码抽离出来具有复用性呢？</p> <p><strong>思考：</strong></p> <ul><li>每个组件派发的action可能不一样，可能是subAction，可能是addAction</li> <li>每个组件用到的state可能不一样，可能是counter，可能是name</li></ul> <p><strong>解决：</strong></p> <ul><li>将不一样的代码抽离出去，将一样的放到一起</li> <li>怎么抽离呢？用函数传参的方式，将不一样的作为参数传入</li> <li>该函数为工具类函数 写在 <strong>utils</strong> 里面</li></ul> <p><strong>封装connect函数</strong></p> <ul><li>mapStateToProps, mapDispachToProp两个属性传入组件中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispachToProp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">enhanceHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">EnhanceComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
          storeState<span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            storeState<span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">...</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">...</span><span class="token function">mapDispachToProp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    EnhanceComponent<span class="token punctuation">.</span>contextType <span class="token operator">=</span> StoreContext<span class="token punctuation">;</span>

    <span class="token keyword">return</span> EnhanceComponent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在组件中使用connect</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/connect'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  decAction<span class="token punctuation">,</span>
  subAction
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../store/actionCreators&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">About</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前计数<span class="token operator">:</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">subNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">decrement</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">subNumber</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">subAction</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>About<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_10-6第三方库的使用"><a href="#_10-6第三方库的使用" class="header-anchor">#</a> 10.6第三方库的使用</h3> <p>安装：<code>yarn add react-redux</code></p> <h2 id="十一、hooks"><a href="#十一、hooks" class="header-anchor">#</a> 十一、HOOKS</h2> <h3 id="_11-1-usestate"><a href="#_11-1-usestate" class="header-anchor">#</a> 11.1.useState</h3> <p>作用：创建state</p> <ul><li>在函数式组件中使用</li> <li>const [变量, 修改变量方法] = useState(初始值)</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>useState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">你点击了按钮</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text">次</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">按钮</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="setcount的认识"><a href="#setcount的认识" class="header-anchor">#</a> setCount的认识</h4> <p>onClick={e =&gt; setCount(count + 1)}代表了可以直接修改数据</p> <p>也可以通过该方法拿到上一次的值</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><p>原理适合setState一样的，传入参数为函数时可以拿到先前值，进行多次累加也会进行合并,比如：</p> <ul><li>传参不是函数多次累加只会操作一次</li> <li>传参时函数就会累加</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 参数不是函数时</span>
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 参数为函数时，和setState一样，进行多次操作</span>
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+10</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_11-2-useeffect的使用"><a href="#_11-2-useeffect的使用" class="header-anchor">#</a> 11.2.useEffect的使用</h3> <p>作用：让你完成一些类似于class中生命周期的功能，网络请求，手动更新DOM，事件监听，都是React更新DOM的一些副作用(Side Effects)。</p> <p>用法举例：</p> <ul><li>第一个参数为回调函数,当组件被渲染出来会执行该函数</li> <li>相当于把updated和mounted合二为一</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">TitleCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> count
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>应用场景</strong>：</p> <ul><li>类组件在mounted里面订阅事件，在unmounted里面取消订阅</li> <li>更新事件时，会先执行返回函数(取消事件)，在执行mounted</li> <li>点击+1会先取消，在订阅</li> <li>当在useEffect后面加入加入第二个参数，数据变化时就不会频繁执行订阅和取消</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HookSubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// 相当于mounted</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'订阅'</span><span class="token punctuation">)</span>
      
    <span class="token comment">// 相当于 unmounted</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'取消订阅'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>多个Effect的使用与依赖</strong>：</p> <ul><li>会按照顺序执行</li> <li>如果没有[ ]的话只要是重新渲染就会执行更新</li> <li>里面填依赖变量，当变量发生变化的时候才会执行更新</li> <li>下面count发生变化时才会执行clg，否则不会</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MutilEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改DOM'</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'订阅事件'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'网络请求'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_11-3-usecontext"><a href="#_11-3-usecontext" class="header-anchor">#</a> 11.3.useContext</h3> <p>作用：获取context传进来的数据</p> <p>例子：</p> <ul><li>在父级组件共享好数据，在子组件本身可通过useContext获取到值</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// App.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> UserTheme <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// App.js的jsx</span>
<span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'qmj'</span><span class="token punctuation">,</span>age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserTheme.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>fontSize<span class="token operator">:</span><span class="token string">'30px'</span><span class="token punctuation">,</span>color<span class="token operator">:</span><span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConetxtHook</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserTheme.Provider</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">// 组件</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserTheme<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>theme<span class="token punctuation">)</span> <span class="token comment">// 相应数据</span>
</code></pre></div><h3 id="_11-4-usereducer"><a href="#_11-4-usereducer" class="header-anchor">#</a> 11.4.useReducer</h3> <p>看到这个第一眼以为是reducer的替代品，但其实不是。</p> <p>useReducer是useState的替代方案：</p> <ul><li>在某些场景下，state处理的逻辑比较复杂，可以通过useReducer进行拆分；</li> <li>或者这次修改的state需要依赖之前的state时，可以使用；</li></ul> <p>例子：</p> <ul><li><p>第一个参数为reducer</p></li> <li><p>看第二个参数是否为对象，进行不同的修改方法</p></li> <li><p>对象就拷贝，不是就直接修改</p></li> <li><p>在多个组件使用同一个reducer，不会共享数据，完全是修改自己组件的数据</p></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;increment&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span><span class="token number">1</span>  <span class="token comment">// 第二个参数不为对象时</span>
      retrun <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 第二个参数为一个单个值，state=第二个参数，修改数据时直接操作</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span>dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 第二个参数也可以为一个对象，name进行修改时需要拷贝</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span>dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token punctuation">{</span>count<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数：</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">'increment'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">'decrement'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_115-usecallback"><a href="#_115-usecallback" class="header-anchor">#</a> 115.useCallback</h3> <p>作用：性能优化，他会返回函数的memoized(记忆值)，在依赖不变的情况下，多次定义的时候值是相同的</p> <p>当组件重新渲染的时候，组件重新定义，且函数也重新定义，加入依赖的时，依赖变化才会重新定义，依赖不变则不会重新定义。空依赖代表一直不会重新定义</p> <p>使用场景：</p> <ul><li>把父组件的函数传递给子元素(组件)进行回调时。</li> <li>没有useCallback每次函数重新创建子元素包裹memo都会重新渲染。</li> <li>使用了useCallback，依赖不变时，每次传进去的函数是不变的，所以不会重新渲染</li></ul> <p>例子1：</p> <ul><li>这种代码并不能阻止函数的创建过程</li> <li>所有并没有做优化</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CallBackHook01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前计数<span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>例子2:</p> <h2 id="十二、react-router"><a href="#十二、react-router" class="header-anchor">#</a> 十二、react-router</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于:</span> <span class="time">12/25/2020, 9:20:27 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/JavaScript/解剖Map对象.html" class="prev">
        解剖Map对象
      </a></span> <span class="next"><a href="/pages/React/redux学习.html">
        Redux学习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ab08ac82.js" defer></script><script src="/assets/js/2.fe6dca74.js" defer></script><script src="/assets/js/102.4b0b16e2.js" defer></script>
  </body>
</html>
