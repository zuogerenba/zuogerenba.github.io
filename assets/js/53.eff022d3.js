(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{520:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、为什么xmlhttprequest不能跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、为什么xmlhttprequest不能跨域"}},[t._v("#")]),t._v(" 一、为什么XMLHttpRequest不能跨域")]),t._v(" "),s("h3",{attrs:{id:"_1-什么是同源策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是同源策略"}},[t._v("#")]),t._v(" 1.什么是同源策略？")]),t._v(" "),s("ul",[s("li",[t._v("同协议，同域名，同端口就是同源策略。")])]),t._v(" "),s("h2",{attrs:{id:"二、xss攻击-跨站脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、xss攻击-跨站脚本"}},[t._v("#")]),t._v(" 二、XSS攻击——跨站脚本")]),t._v(" "),s("p",[t._v("概念：指黑客往HTML文件中或者DOM中注入恶意脚本，从而在用户浏览页面时利用注入的恶意脚本对用户实施攻击。一开始是通过跨域进行攻击，但是现在通过往HTML文件中注入恶意代码的方式很多，所以跨域注入脚本已经不是唯一注入手段。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("XSS 翻译过来是，跨站脚本。早期是通过跨域的方式进行攻击。后来注入恶意代码的方式比较多。因为浏览器无法识别是恶意脚本，所以恶意脚本有着普通脚本的所有权限。\n")])])]),s("h4",{attrs:{id:"恶意脚本可以干什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恶意脚本可以干什么"}},[t._v("#")]),t._v(" 恶意脚本可以干什么？")]),t._v(" "),s("p",[t._v("1."),s("strong",[t._v("窃取Cooike信息")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("恶意JS可以通过 document.cooike 获取cookie信息，然后通过XMLHttpRequest或者Fetch加上CORS功能将数据发送给恶意服务器，拿到信息后就可以模拟用户登录，进行转账等操作。\n")])])]),s("p",[t._v("2."),s("strong",[t._v("监听用户行为")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("JS可以通过 addEventlistener 接口监听键盘事件，输入账号密码等操作完全被监听。\n")])])]),s("p",[t._v("3."),s("strong",[t._v("恶意广告")])]),t._v(" "),s("h4",{attrs:{id:"怎么注入恶意脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#怎么注入恶意脚本"}},[t._v("#")]),t._v(" 怎么注入恶意脚本")]),t._v(" "),s("p",[t._v("1."),s("strong",[t._v("存储型XSS攻击")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("将恶意脚本存入存在漏洞的服务器，用户去访问这个页面的服务器，然后可以通过脚本获取信息，再上传到攻击者的服务器。\n")])])]),s("p",[s("strong",[t._v("2.反射型XSS攻击")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("就是用户在点击QQ邮箱等恶意链接的时候，将恶意脚本嵌入请求中，用户就会把恶意脚本提交到服务器上，服务器接收到又会反射给浏览器端。\n\n因web端不会存储恶意脚本，所以这是和存储型攻击的区别。\n")])])]),s("p",[s("strong",[t._v("3.基于DOM的XSS攻击")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("这种攻击方式是不需要涉及服务器的，黑客通过各种手段将恶意脚本注入用户的页面，在HTML传输过程中劫持并修改HTML的内容。 WiFi路由劫持，本地恶意软件\n")])])]),s("h4",{attrs:{id:"如何阻止xss攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何阻止xss攻击"}},[t._v("#")]),t._v(" 如何阻止XSS攻击")]),t._v(" "),s("p",[s("strong",[t._v("存储型攻击")]),t._v("和"),s("strong",[t._v("反射型攻击")]),t._v("都需要经过服务器，所以可以认为这是服务器漏洞型。")]),t._v(" "),s("p",[t._v("而 "),s("strong",[t._v("基于DOM的XSS攻击")]),t._v("是在浏览器端发生的，因此基于DOM的XSS攻击时前端的漏洞。")]),t._v(" "),s("p",[t._v("以上三者的共同点都是注入恶意脚本，所以可以考虑阻止恶意脚本的注入和恶意消息的发送来实现。")]),t._v(" "),s("p",[s("strong",[t._v("1.服务器对输入脚本进行过滤或转码")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("尽量的将 script标签给过滤 或者转码，转码就不会执行。\n&lt;script&gt;\n")])])]),s("p",[s("strong",[t._v("2.充分利用SCP")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("虽然转码可以阻止XSS攻击，但这是完全依赖服务端的。充分利用SCP可以降低XSS攻击带来的风险和后果。\n\nSCP有以下功能：\n\t1.限制下载其他域资源，就算黑客插入JS文件，也无法加载。\n\t2.禁止向第三方提交数据，用户数据不会外泄。\n\t3.禁止执行内联脚本和未授权的脚本。\n\t4.有上报功能。\n")])])]),s("h2",{attrs:{id:"三、csrf攻击-跨站请求伪造"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、csrf攻击-跨站请求伪造"}},[t._v("#")]),t._v(" 三、CSRF攻击——跨站请求伪造")]),t._v(" "),s("p",[s("strong",[t._v("简单的例子：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("1.小明发起登录邮箱请求，服务器返回登录状态给小明的浏览器，这些信息包括Cookie，Session等信息，这样小明的浏览器就处于登录状态了。\n2.黑客引诱小明点击恶意链接，比如hacker.com，黑客在里面编写好一个邮件过滤器，通过Gmail提供的HTTP设置接口设置好了新的邮件过滤功能，该过滤器会将小明所有的邮件转发到黑客邮箱。\n")])])]),s("h4",{attrs:{id:"_1-什么是csrf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是csrf"}},[t._v("#")]),t._v(" "),s("strong",[t._v("1.什么是CSRF")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("指的是黑客引诱用户打开黑客的网站，在黑客网站中，利用用户的登录状态发起的跨站请求。\n概括：CSRF攻击时黑客利用用户的登录状态，利用第三方站点做一些坏事。\n")])])]),s("h4",{attrs:{id:"_2-csrf攻击方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-csrf攻击方式"}},[t._v("#")]),t._v(" 2.CSRF攻击方式")]),t._v(" "),s("p",[t._v("下面是一个转账的接口")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 同时支持 POST 和 Get \n# 接口 https://time.geekbang.org/sendcoin \n# 参数 \n## 目标用户 \nuser \n## 目标金额 \nnumber\n")])])]),s("p",[t._v("有了上面转账接口，就可以模拟CSRF攻击了")]),t._v(" "),s("p",[s("strong",[t._v("1.自动发起Get请求")])]),t._v(" "),s("ul",[s("li",[t._v("属于最容易的攻击方式")]),t._v(" "),s("li",[t._v("黑客将转账请求接口隐藏在img标签内，欺骗浏览器这是一张图片，页面被加载，发起img资源请求，服务器没判断的话，服务器就会认为该转账请求时一个转账请求，于是用户的钱就被转走了")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('\n<!DOCTYPE html> \n<html>\n\t<body>\n    \t<h1> 黑客的站点：CSRF 攻击演示 </h1>   \n        <img src="https://time.geekbang.org/sendcoin?user=hacker&number=100">  \n    </body>\n</html>\n')])])]),s("p",[s("strong",[t._v("2.自动发起POST请求")])]),t._v(" "),s("p",[t._v("除了自动发送Get请求之外，有些服务器接口是使用POST方法的，所以黑客需要在他的站点上伪造POST请求，当用户打开黑客的站点时，是自动提交POST请求。具体代码如下")]),t._v(" "),s("ul",[s("li",[t._v("这段代码中，黑客在他的页面中构建了一个隐藏的表单，该表单内容就是转账接口。用户打开后就会被自动提交，进行转账，因此使用构建自动提交 表单这种方式，就可以自动实现跨站点POST数据提交。")])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" 黑客的站点：CSRF 攻击演示 "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("hacker-form"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://time.geekbang.org/sendcoin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("POST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hacker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hacker-form'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])]),s("p",[s("strong",[t._v("3.引诱用户点击链接")])]),t._v(" "),s("p",[t._v("引诱用户点击黑客站点上的链接，着这种方式通常出现在论坛或者恶意邮件上。")]),t._v(" "),s("p",[t._v("例如：一个a标签上是点击下载美女照片，实际上href是一个转账接口，点了就完蛋。")]),t._v(" "),s("h3",{attrs:{id:"_3-如何防止csrf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-如何防止csrf"}},[t._v("#")]),t._v(" 3.如何防止CSRF")]),t._v(" "),s("p",[s("strong",[t._v("1.利用好Cookie的SameSite属性")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("因为CSRF是依靠登录态发起攻击的，Cookie是浏览器和服务器之间维护登录状态的一个关键数据。\nCSRF是通过第三方站点发起的，从第三方站点禁止Cookie的发送。所以在浏览器通过不同来源发送HTTP请求，主要有一下区别：\n\t1.从第三方站点发送请求，则禁止浏览器发送某些关键的Cookie数据到服务器上。\n\t2.如果是同一个站点发起的请求，就需要保证Cookie数据正常发送。\n\n在HTTP响应头中，通过set-cookie字段设置Cookie时，可以带上SameSite选项。\n")])])]),s("p",[s("strong",[t._v("2.验证请求的来源站点")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("在服务端验证请求来源的站点，csrf大多数来自第三方站点，禁止第三方站点可以降低攻击概率。\n如何判断第三方站点：\n\t请求头中的Referer字段可以判断请求来源站点的，但是浏览器有些时候直接暴露url是不合适的，这个时候又可以使用origin属性，XMLHttpRequest、Fecth 发起跨站请求或者通过 Post 方法发送请求时，都会带上 Origin 属性。\n")])])]),s("p",[s("strong",[t._v("c3.CSRF Token")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('这个流程有两步：\n\t1.浏览器发起请求时，生成csrf token，服务生成的简单字符串，再将字符串植入返回的页面中。input value="dawdawd13ds"\n\t2.在浏览器端发起转账请求的话，需要带上token，服务器验证token是否合法，第三方肯定是无法获取token的，所以无法发起请求。\n')])])])])}),[],!1,null,null,null);a.default=e.exports}}]);